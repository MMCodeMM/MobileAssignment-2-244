<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>我的收藏 - MAX教學運動平台</title>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js"></script>
  <script nomodule src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="auth.css">
</head>
<body>
  <ion-app>
    <ion-header>
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-button onclick="goToHome()">
            <i class="fas fa-arrow-left"></i>
          </ion-button>
        </ion-buttons>
        <ion-title>我的收藏</ion-title>
        <ion-buttons slot="end">
          <ion-button onclick="showFavoritesMenu()">
            <i class="fas fa-ellipsis-v"></i>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>

      <!-- 收藏統計和篩選 -->
      <div class="favorites-header">
        <div class="favorites-stats">
          <div class="stat-item">
            <span class="stat-number favorites-count">0</span>
            <span class="stat-label">總收藏</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="recent-count">0</span>
            <span class="stat-label">本週新增</span>
          </div>
        </div>
        
        <ion-searchbar id="favorites-search" placeholder="搜尋收藏項目..."></ion-searchbar>
        
        <div class="favorites-filters">
          <ion-select id="favorites-category" label="分類篩選" interface="popover" class="category-select">
            <ion-select-option value="">全部收藏</ion-select-option>
          </ion-select>
          <ion-button id="clear-favorites-filter" fill="clear" style="display: none;">
            <i class="fas fa-times"></i>
            清除篩選
          </ion-button>
        </div>
      </div>
    </ion-header>

    <ion-content>
      <div id="content-wrapper">
        <div class="container">
          
          <!-- 收藏項目網格 -->
          <div class="exercise-grid" id="favorites-grid"></div>

          <!-- 空收藏提示 -->
          <div id="no-favorites" class="no-results" style="display: none;">
            <i class="fas fa-heart-broken"></i>
            <h3>還沒有收藏任何項目</h3>
            <p>瀏覽運動項目並點擊愛心圖標來收藏您喜歡的內容</p>
            <ion-button onclick="goToHome()" class="auth-button">
              <i class="fas fa-dumbbell"></i>
              瀏覽運動項目
            </ion-button>
          </div>

          <!-- 無搜尋結果提示 -->
          <div id="no-search-results" class="no-results" style="display: none;">
            <i class="fas fa-search"></i>
            <h3>沒有找到符合的收藏項目</h3>
            <p>請嘗試其他搜尋詞或清除篩選條件</p>
          </div>

        </div>
      </div>
    </ion-content>

    <!-- 收藏操作選單 -->
    <div id="favorites-menu" class="auth-modal" style="display: none;">
      <div class="modal-backdrop" onclick="closeFavoritesMenu()"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3>收藏管理</h3>
          <button class="modal-close" onclick="closeFavoritesMenu()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="menu-options">
            <button class="menu-option" onclick="showFavoritesStats()">
              <i class="fas fa-chart-bar"></i>
              <div>
                <strong>查看統計</strong>
                <p>收藏項目的詳細統計資訊</p>
              </div>
            </button>
            
            <button class="menu-option" onclick="exportFavorites()">
              <i class="fas fa-download"></i>
              <div>
                <strong>匯出收藏</strong>
                <p>將收藏清單匯出為 JSON 檔案</p>
              </div>
            </button>
            
            <button class="menu-option" onclick="sortFavorites()">
              <i class="fas fa-sort"></i>
              <div>
                <strong>排序選項</strong>
                <p>按時間、名稱或類別排序</p>
              </div>
            </button>
            
            <button class="menu-option danger" onclick="clearAllFavorites()">
              <i class="fas fa-trash"></i>
              <div>
                <strong>清空收藏</strong>
                <p>移除所有收藏項目（不可復原）</p>
              </div>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- 統計資訊模態框 -->
    <div id="stats-modal" class="auth-modal" style="display: none;">
      <div class="modal-backdrop" onclick="closeStatsModal()"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3>收藏統計</h3>
          <button class="modal-close" onclick="closeStatsModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div id="stats-content">
            <!-- 統計內容將動態生成 -->
          </div>
        </div>
      </div>
    </div>

    <!-- 排序選項模態框 -->
    <div id="sort-modal" class="auth-modal" style="display: none;">
      <div class="modal-backdrop" onclick="closeSortModal()"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3>排序選項</h3>
          <button class="modal-close" onclick="closeSortModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="sort-options">
            <button class="sort-option" onclick="applySorting('addedAt', 'desc')">
              <i class="fas fa-clock"></i>
              <span>最新收藏</span>
            </button>
            <button class="sort-option" onclick="applySorting('addedAt', 'asc')">
              <i class="fas fa-history"></i>
              <span>最早收藏</span>
            </button>
            <button class="sort-option" onclick="applySorting('title', 'asc')">
              <i class="fas fa-sort-alpha-down"></i>
              <span>名稱 A-Z</span>
            </button>
            <button class="sort-option" onclick="applySorting('title', 'desc')">
              <i class="fas fa-sort-alpha-up"></i>
              <span>名稱 Z-A</span>
            </button>
            <button class="sort-option" onclick="applySorting('level', 'asc')">
              <i class="fas fa-layer-group"></i>
              <span>按等級排序</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- 圖片放大預覽模態 -->
    <div id="image-modal" class="image-modal" style="display: none;">
      <div class="modal-backdrop" id="modal-backdrop"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modal-title">圖片預覽</h3>
          <button class="modal-close" id="modal-close">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <img id="modal-image" src="" alt="放大圖片" />
          <div class="image-loading" id="image-loading">
            <i class="fas fa-spinner fa-spin"></i>
            <div>載入中...</div>
          </div>
          <div class="image-error" id="image-error" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            <div>圖片載入失敗</div>
          </div>
        </div>
        <div class="modal-footer">
          <div class="image-info" id="image-info"></div>
        </div>
      </div>
    </div>

    <!-- Toast 訊息容器 -->
    <div id="toast-container"></div>

  </ion-app>

  <script src="auth.js"></script>
  <script src="favorites.js"></script>
  <script src="favorites-page.js"></script>
</body>
</html>